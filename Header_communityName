(function () {

  angular.element(document).ready(function () {

    const injector = angular.element(document.body).injector();
    const $timeout = injector.get('$timeout');

    $timeout(function () {

      const raw =
        new URL(window.location.href).searchParams.get("community") || "";

      const community =
        decodeURIComponent(raw).replace(/\+/g, " ");

      if (!community) return;

      function run(doc) {

        const header = doc.querySelector(".pre-content");
        if (!header) return false;

        if (doc.getElementById("community-title")) return true;

        const title = doc.createElement("div");
        title.id = "community-title";
        title.innerText = "רישום לקהילת " + community;

        title.style.textAlign = "center";
        title.style.fontWeight = "bold";
        title.style.margin = "6px 0";

        const isMobile = doc.defaultView.innerWidth < 600;
        title.style.fontSize = isMobile ? "8px" : "14px";

        header.appendChild(title);
        return true;
      }

      // main document
      if (run(document)) return;

      // iframe
      const iframe = document.querySelector("#iframe_div iframe");
      if (iframe && iframe.contentDocument) {
        run(iframe.contentDocument);
      }

    }, 0); // next digest tick

  });

})();
